# Social Sentry PC: Codebase Analysis & Roadmap

**Date**: 2026-01-21
**Version**: 0.1 (Alpha Analysis)

## 1. Current State ("What Should Happen" vs "What Is Happening")

The application is designed to be a "Digital Wellbeing" and "Parental Control" tool. It currently functions as a **basic activity logger** with **rudimentary blocking**.

### ✅ What IS Working:
*   **Activity Tracking**: The `ActivityTracker` successfully hooks into Windows events (`SetWinEventHook`) to detect the active window and process name.
*   **Browser URL Capture**: `BrowserMonitor` allows capturing URLs from Chrome, Edge, and Brave using UI Automation.
*   **Basic Statistics**: The app calculates time spent per "hardcoded" category (Entertainment, Productive, etc.).
*   **Blocking Logic**: `BlockerService` can detect forbidden keywords/URLs and perform a "Back + Clear Text + Overlay" sequence.
*   **Data Persistence**: Data is stored locally in an SQLite database.
*   **Mastersqlalinhere**: The backup SQL file exists for disaster recovery.

### ❌ What Is MISSING ("What It Is Not"):

#### A. No "Brain" (Context Awareness)
The app is currently "dumb". It sees `chrome.exe` but doesn't know if you are working or wasting time unless the URL matches a hardcoded string.
*   **Missing**: **Media Playback Detection**. It cannot tell if a video is playing.
*   **Missing**: **Dynamic Rule Engine**. Categories are hardcoded in `CategoryViewModel.cs` using simple string `Contains()` (e.g., `if (name.Contains("youtube"))`). This is brittle and unscalable.
*   **Missing**: **Heuristics**. No logic to distinguish "Reading a tutorial" vs "Doom scrolling" based on scroll intensity or dwell time.

#### B. Security Gaps (Self-Protection)
The app claims to be "Parental Control" grade, but it lacks the teeth to enforce it against a tech-savvy user.
*   **Stubbed**: `SelfProtectionService.cs` has the ACL (Access Control List) logic explicitly commented out (`// ACL modification bypassed`). Any user can open Task Manager and kill the process.
*   **Watchdog**: While the code to start a watchdog exists, the rigorous communication betwen App <-> Watchdog (heartbeat checks) is minimal.

#### C. Database & Sync
*   **No Cloud Sync**: The app is purely local. There is no integration with Supabase for remote monitoring (Parental Dashboard), despite user rules mentioning it.
*   **Hardcoded Base Rules**: `BlockerService.cs` wipes and re-adds hardcoded rules ("porn", "shorts") every time rules are loaded. This makes it impossible for a user to *allow* these things if they ever wanted to, as the code overrides the DB.

---

## 2. Future Roadmap ("What We Should Do")

### Phase 1: Robustness (Immediate Fixes)
1.  **Refactor Categorization**: Move the logic OUT of `CategoryViewModel` and into a dedicated `ClassificationService`. Use a database-backed rule system (e.g., `Table: ClassificationRules`) instead of `if (name.Contains("steam"))`.
2.  **Fix Blocker Logic**: Remove the hardcoded "Base Rules" in `BlockerService`. Load *everything* from the database. Insert the default rules into the DB on first run instead.
3.  **Enable Self-Protection**: Carefully implement the Process ACLs to prevent termination by non-SYSTEM users.

### Phase 2: Context Intelligence
1.  **Media Detector**: Implement `Windows.Media.Control` API to detect if audio/video is playing. This allows distinguishing "Spotify (Music)" from "Spotify (Idle)".
2.  **Input Heuristics**: Track mouse distance / scroll wheel intensity (without logging keystrokes) to determine specific engagement levels.

### Phase 3: Ecosystem (Cloud & Mobile)
1.  **Supabase Integration**: Implement the "Baked Database" concept fully.
    *   Upload `ActivityLog` entries to Supabase for remote analysis.
    *   Download `Rules` from Supabase to allow remote blocking.
2.  **Mobile Companion**: A React Native app to view the stats generated by this PC app.

---

## 3. Specific Code Improvements (Where to Touch)

### A. `Social Sentry/ViewModels/CategoryViewModel.cs`
**Current**:
```csharp
// HARDCODED MESS
var entertainmentApps = apps.Where(a => a.Name.Contains("youtube") ...);
```
**Change To**:
```csharp
// DYNAMIC
var rules = _classificationService.GetRules();
foreach(var app in apps) {
    var category = _classificationService.Categorize(app, rules);
}
```

### B. `Social Sentry/Services/BlockerService.cs`
**Current**:
```csharp
_blockedKeywords.Clear();
_blockedKeywords.Add("porn"); // Forces this rule every time
```
**Change To**:
```csharp
// Load ONLY from DB. Default rules should be inserted into DB at Install time.
var dbRules = _dbService.GetRules(); 
_blockedKeywords = dbRules.Where(r => r.Type == "Keyword").Select(r => r.Value).ToList();
```

### C. `Social Sentry/Services/BrowserMonitor.cs`
**Current**: Does not robustly handle Firefox or generic browsers.
**Change To**: Implement a more compatible `UIAutomation` search or investigate `DDE` / `Accessibility` APIs for better cross-browser URL fetching.

### D. `mastersqlalinhere/mastersqlalinhere.txt`
**Action**: ensure this file is ALWAYS updated when the `DatabaseService` schema changes. Typically, this should be an automated Step in the build pipeline or a strict developer rule (as currently defined).

## 4. Summary
The application has a solid "Skeleton" (Hooks, UI, DB), but lacks the "Brain" (Smart Classification) and "Muscle" (Self-Protection) to be a true Social Sentry. The next 2-3 sprints should focus entirely on moving hardcoded logic into the Database and Service layers.
